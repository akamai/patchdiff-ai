{'file': 'fvevol.sys', 'change_count': 42, 'date': 1752036564.2785306, 'kb': 'KB5062553', 'confidence': 0.21, 'cve': 'CVE-2025-48003', 'patch_store_uid': '546cc225-5ff3-4cd7-be6d-d4d62c9a8c45'}
--------------------------------------------------------------------
CVE-2025-48003 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Microsoft BitLocker driver  (fvevol.sys) – Simulated Integrated
Cipher-Engine (ICE) Key-Management Interface (KMI) helper routines
SimIceKmiWrapKey() / SimIceKmiInsertChallenge() and related clean-up
code paths.

Vulnerability Class
--------------------------------------------------------------------
Protection-mechanism failure / improper input validation (CWE-693).
The driver assumed that the underlying ICE/KMI device always
implemented particular capabilities and therefore accepted and stored
incomplete or out-of-spec key-handling data, allowing BitLocker
protection to be bypassed by physical attack.

Detailed Root Cause Analysis
--------------------------------------------------------------------
Two helper routines are reachable through BitLocker’s user / firmware
communication channel:

  • SimIceKmiWrapKey()  – builds a 0x118-byte ICE_WRAPPED_KEY block.
  • SimIceKmiInsertChallenge() – copies an arbitrary length challenge
    into the same structure at offset +0x98.

Before the patch both functions verified their parameters only against
hard-coded constants:
  – key-length  <= 0x20 bytes
  – challenge   <= 0x20 bytes
  – wrapped key <= 0x40 bytes
They never asked the real ICE/KMI device whether those limits were
actually correct, nor did they check if the device supported the
requested operation at all.

Consequences of the missing checks
----------------------------------
1.  A malicious actor with physical access can present a storage device
    that **reports no ICE/KMI capability** yet still supplies superficially
    valid parameter buffers.
2.  fvevol accepts the buffers, fills in the per-volume ICE_KEY
    structure located at devExt+0x11C8 (referenced at a1+4552) and
    marks the key as present.
3.  Once the in-memory flag is set, subsequent paths such as
    FveFilterSurpriseRemoveDevice() and FveDeleteIceKey() skip critical
    provenance checks (the code assumes the firmware has already
    authenticated the volume-master-key).
4.  During early boot or from an offline environment an attacker can
    swap or tamper with the disk and still pass BitLocker’s device
    usage policy, effectively bypassing the encryption safeguard.

Because the driver relied on a *logical* protection mechanism (device
capability enforcement) that could be forged, BitLocker’s physical
protection guarantee could be defeated without touching the cryptography
itself.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// before patch – SimIceKmiWrapKey()
if (!a2 || !a3 || !a4 || *a3 > 0x20u ||
    *(_DWORD *)(a2+16) || *WORD(a2+22) > 0x40u ||
    (*BYTE)(a2+20) & 1)
    return STATUS_LOGON_FAILURE;
...
memmove(a5+88, (void *)(a2+24), *(WORD *)(a2+22));

// before patch – SimIceKmiInsertChallenge()
if (!a2 || !a3 || !a4 || *a3 < 0x118u || *a2 > 0x20u)
    return STATUS_LOGON_FAILURE;
memmove((void *)(a4+152), a2+1, *a2);
```
The absence of SimIceKmiQueryCapabilities() means size and feature
information were never corroborated.

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Attacker connects or emulates a storage device during boot.
2. Windows mounts the volume; fvevol issues ICE/KMI IOCTLs.
3. Crafted responses reach SimIceKmiWrapKey() / InsertChallenge().
4. Functions accept data, set devExt->IceKeyPresent flag.
5. Volume is considered protected although no valid key exchange ever
   happened, enabling access to the encrypted data.

Attack Vector
--------------------------------------------------------------------
Physical access – hot-plug or preload a malicious storage controller /
firmware that forges ICE/KMI capability responses, or use a custom PE
environment to send crafted IOCTLs to fvevol before Windows boots the
protected OS volume.

Patch Description
--------------------------------------------------------------------
• Both routines now invoke SimIceKmiQueryCapabilities() to retrieve a
  128-bit capability record.
• Validation is performed against capability-specific maxima instead of
  fixed magic numbers.
• Operations are refused if the device advertises no support, if
  required auxiliary buffers are missing, or if lengths exceed what the
  device claims to handle.
• Consistent STATUS_INVALID_PARAMETER / STATUS_NOT_SUPPORTED error codes
  replace previously misleading ones.
• Additional defence-in-depth: lock acquisition, read/write rundown and
  extra zeroisation paths were added to FveFilterSurpriseRemoveDevice()
  and FveDeleteIceKey().

Security Impact
--------------------------------------------------------------------
Without the patch, BitLocker may erroneously mark a volume key as
validated, allowing an attacker with physical access to circumvent the
boot-time protection and unlock or manipulate encrypted data. The issue
does not require code execution and therefore is classified as a
Security Feature Bypass rather than privilege escalation.

Fix Effectiveness
--------------------------------------------------------------------
The added capability query and parameter checks close the direct logic
flaw. Provided the capability data returned by hardware / firmware is
trustworthy, the bypass is neutralised. No residual path accepting
unverified key material was observed in the patched code; however the
overall assurance still depends on integrity of the underlying
ICE/KMI implementation, which is outside the scope of this fix.
