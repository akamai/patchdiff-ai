{'kb': 'KB5062553', 'confidence': 0.26, 'change_count': 1, 'cve': 'CVE-2025-48800', 'patch_store_uid': 'dcd36030-39a9-478e-bc2f-d15ad238a416', 'file': 'bdeunlock.exe', 'date': 1752036258.164755}
--------------------------------------------------------------------
CVE-2025-48800 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows BitLocker user-mode unlock helper (bdeunlock.exe) –
CFveApiWrapper::GetStatusFlagsFromName()

Vulnerability Class
--------------------------------------------------------------------
Stack-based buffer overflow caused by structure size mismatch
(CWE-121 / CWE-693)

Detailed Root Cause Analysis
--------------------------------------------------------------------
GetStatusFlagsFromName() obtains the BitLocker status of a volume by
calling the kernel FVE service:
    1. FveOpenVolumeW() – obtains a handle (v5)
    2. FveGetStatus()   – fills a caller-supplied buffer with a
       FVE_STATUS structure whose first DWORD must contain the total
       size of that buffer.

The function builds the request buffer on the stack in two disjoint
objects:
    v6 – int[2] used as the structure header
    v7 – char[?] intended to hold the remaining bytes

Before the patch the code initialised them as follows:
    memset(v7, 0, 0x80);          // zero 128  bytes
    v6[0] = 136;                  // declare 136 bytes to FVE
    v6[1] = 9;                    // request id

Because the advertised length (136) exceeded the actually cleared
memory (128) by 8 bytes, FveGetStatus() copied 8 extra bytes past the
end of the buffer, corrupting adjacent stack variables including the
saved non-volatile registers and, on x64, the chained exception
handler pointer.  The overflow is small but sufficient to alter
control data and influence the program’s control flow when the
function returns.

The drive path (a1) is attacker-controlled in several GUI and command
line flows, so a user with physical access to the target computer can
trigger the vulnerable routine merely by inserting a storage device
that causes bdeunlock.exe to run (e.g., the "unlock with USB" feature).
No additional privileges are needed.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// vulnerable code (before)
memset_0(v7, 0, 0x80);   // clears 128 bytes
v6[0] = 136;             // tells FVE we have 136 bytes -> overflow
v6[1] = 9;
Status = FveGetStatus(v5, v6);

// fixed code (after)
memset_0(v7, 0, 0x78);   // clears 120 bytes
v6[0] = 128;             // length now matches real buffer size
v6[1] = 9;
Status = FveGetStatus(v5, v6);
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
CBdeUnlockUIController::OnListenedEvent()
 ➜ _UnlockWithUSB()
    ➜ CFveDriveType::CheckIsPortableDrive()
       ➜ CFveApiWrapper::GetStatusFlagsFromName()  ← overflow occurs

Attack Vector
--------------------------------------------------------------------
Physical attacker connects a storage device that causes BitLocker
unlock helper to query its encryption status.  The malformed buffer is
built and overflows automatically; no special payload needs to be sent
through other channels.

Patch Description
--------------------------------------------------------------------
Microsoft reduced the advertised structure length from 136 (0x88) to
128 (0x80) bytes and correspondingly shortened the memset() to 0x78
(120) bytes, bringing the actual buffer size, the cleared size, and
the size field passed to FveGetStatus() back into agreement.  No other
logic was changed.

Security Impact
--------------------------------------------------------------------
The 8-byte overwrite occurs on the process stack of a signed,
auto-elevating system binary running as the invoking user.  An
attacker can corrupt saved registers or frame pointers, potentially
leading to arbitrary code execution inside bdeunlock.exe.  Since the
utility runs before BitLocker unlock, code execution can bypass the
intended pre-boot protection, yielding a BitLocker Security Feature
Bypass.

Fix Effectiveness
--------------------------------------------------------------------
The patch fully removes the overflow by enforcing consistent structure
sizes.  Provided FVE_STATUS remains 128 bytes on all supported builds,
the vulnerability is closed.  No residual or alternate path using the
old size was observed in the diff.
