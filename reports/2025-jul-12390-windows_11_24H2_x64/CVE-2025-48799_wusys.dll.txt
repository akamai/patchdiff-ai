{'kb': 'KB5062553', 'patch_store_uid': 'a014e5bc-cfcb-48f5-83a9-3549e51e667d', 'confidence': 0.22, 'cve': 'CVE-2025-48799', 'change_count': 4, 'date': 1752036895.8282206, 'file': 'wusys.dll'}
--------------------------------------------------------------------
CVE-2025-48799 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
WinStoreAuth runtime (wusys.dll) used by the Windows Update / Store
service stack.  The affected functions are
  • AuthenticationInternal::ExtractAccountId()
  • AuthenticationInternal::ExtractProviderType()
Both are helper routines that translate IWebAccount* /
IWebAccountProvider* COM objects into internal identifiers.


Vulnerability Class
--------------------------------------------------------------------
NULL-pointer dereference / missing input validation (CWE-476).  The
crash occurs while dereferencing a user-supplied COM pointer that may
legitimately be NULL.


Detailed Root Cause Analysis
--------------------------------------------------------------------
Prior to the patch, both helper functions assumed that the caller
passed a valid, non-NULL Microsoft::WRL::ComPtr object whose internal
pointer (*a1) is also non-NULL.  They immediately dereferenced the
pointer to access the v-table, e.g.
    v5 = (**a1)[6];              // ExtractProviderType()
    v3 = ComPtr::As(a1,&v9);     // ExtractAccountId()

If *a1 == NULL the first memory access touches address 0x0 and the
process terminates with STATUS_ACCESS_VIOLATION.  Because the code runs
inside service processes running as LocalSystem (Windows Update
service, Store service, etc.), an unprivileged client that can induce a
NULL IWebAccount*/IWebAccountProvider* causes the service to crash.

Key variables and paths
  a1   – pointer to caller-supplied ComPtr
  *a1  – raw IWebAccount*/IWebAccountProvider* (may be NULL)
  (**a1)[x] – v-table dereference that faults when *a1 == NULL

The fault is reachable through higher-level helpers such as
  CWUSystemInterface::GetAllAccountTickets()
which ultimately forward user-controlled parameters into the vulnerable
extractor routines without validation.


Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// BEFORE – ExtractAccountId
v3 = Microsoft::WRL::ComPtr<...>::As<...>(a1, &v9);   // a1 used blindly

// BEFORE – ExtractProviderType
v5 = (**a1)[6];                                       // *a1 may be NULL
```
```c
// AFTER – added guard (AccountId example)
if (!Feature_NullAccountCrashFix_IsEnabled || *a1) {
    v10 = 0;
    v5 = ComPtr::As(a1, &v10);
    ...
} else {
    v4 = E_POINTER;          // 0x80004003
    Return_Hr(...);
    return v4;
}
```


Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Unprivileged caller invokes a public API that eventually calls
   GetAllAccountTickets().
2. The call path enters
   AuthenticationInternal::ExtractAccountId()/ExtractProviderType().
3. Caller supplies a default-constructed ComPtr => *a1 == NULL.
4. Pre-patch code dereferences **a1, faults at address 0.
5. Service process running as SYSTEM crashes.


Attack Vector
--------------------------------------------------------------------
Local code running in the user session that can reach the Windows Store
/ Update broker APIs passes a NULL IWebAccount* or IWebAccountProvider*
object.  No special privileges are required to supply the malformed
parameter.


Patch Description
--------------------------------------------------------------------
• Function signatures changed to receive a pointer to the ComPtr so the
  internal raw pointer (*a1) can be validated first.
• Added feature-flag gates
    Feature_NullAccountCrashFix
    Feature_ExtractProviderTypeCrashFix
  and early exits that return E_POINTER/0 when *a1 is NULL.
• Updated error-handling paths and unique Return_Hr() IDs (2749 =>
  2761/2763 etc.) to distinguish the new failure cases.
• No other logic or data-structure changes were made.


Security Impact
--------------------------------------------------------------------
Prior to the fix, any user could crash the Windows Update / Store
service, leading to a persistent denial-of-service and possible loss of
update functionality.  Because NULL-page mapping is blocked on modern
Windows, code execution is unlikely; the practical risk is service
instability and potential loss of defense-in-depth protections that the
service provides.


Fix Effectiveness
--------------------------------------------------------------------
The explicit *a1 NULL checks fully remove the faulting code path when
the feature flag is enabled.  No further dereferences occur without a
preceding validity check, so the immediate crash vector is resolved.
Residual risk: if the feature flag is disabled by policy the original
behavior returns; however, Microsoft typically enables such mitigation
flags for all supported SKUs, making the fix effective in practice.
