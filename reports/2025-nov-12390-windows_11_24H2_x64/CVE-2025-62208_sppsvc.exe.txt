{'kb': 'KB5066835', 'file': 'sppsvc.exe', 'patch_store_uid': 'e036112f-b556-4011-858d-784aad5eed8e', 'change_count': 385, 'cve': 'CVE-2025-62208', 'confidence': 0.36, 'date': 1763409669.3225417}
--------------------------------------------------------------------
CVE-2025-62208 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows License Manager Service (sppsvc.exe) – internal routines
sub_140103484 and sub_140102274, renamed after the update to
sub_140061C60 and sub_140061C10 respectively.

Vulnerability Class
--------------------------------------------------------------------
CWE-532: Insertion of Sensitive Information into Log File

Detailed Root Cause Analysis
--------------------------------------------------------------------
Prior to the patch both routines implemented their own logic for
collecting and persisting license state flags.

1. sub_140103484 (addr 0x140103484)
   • Queries the Software Protection Platform (SPP) engine through an
     indirect call located in qword_14046B468 / qword_14046B460.
   • Derives several bit-fields (0xC00, 0x40, 0x80, etc.) that encode
     activation status, grace period, tamper flags, etc.
   • Calls sub_14010EBD4(&unk_14046CA30, …) – a runtime policy check
     that can be bypassed when the previous evaluation sets the low
     byte of the second argument to 0.
   • When the policy permits, it fetches a 32-bit global variable
     dword_14046C9D0 via sub_140102274 and stores the value in v15.
   • Finally it logs this information with
       sub_1400A5B88(&unk_14046C9D8, 45036776, (v15>>10)&1,
                     (v15>>11)&1, &v17, 1, 0);
     The buffer v17 contains the caller-supplied input a1 combined with
     WORD2(v17)=3, effectively writing raw licence state directly to
     the SPP event channel.

2. sub_140102274 (addr 0x140102274)
   • Reads the same global (dword_14046C9D0) and, if certain flag bits
     are not set, updates it by means of atomic
     _InterlockedCompareExchange operations.
   • Uses the same indirect function table (qword_14046B468 / 460) to
     query policy, then decides whether to set or clear bits 0x40, 0x80
     and 0x400.
   • When the global value transitions from "no flags" to a non-zero
     value it invokes sub_140089A28 which triggers additional event log
     entries.

Because no caller authentication or data scrubbing is performed before
sub_1400A5B88 is executed, any local user able to reach the RPC or COM
endpoint that maps to these routines can force the service to emit its
current licence state into the Windows event log.  The event log is
readable by BUILTIN\Users, so the information becomes available to
non-privileged accounts.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// --- extracted from pre-patch sub_140103484 ---
if ((unsigned __int8)sub_14010EBD4(&unk_14046CA30, v9)) {
    v15 = dword_14046C9D0;
    if ((dword_14046C9D0 & 4) == 0) {
        v18 = *(_QWORD *)sub_140102274(&dword_14046C9D0, &v19);
        v15 = v18;
    }
    LODWORD(v17) = 0;        // user-controlled low dword
    WORD2(v17)  = 3;         // constant 3
    sub_1400A5B88(&unk_14046C9D8, 45036776,
                 (v15 >> 10) & 1,
                 (v15 >> 11) & 1,
                 &v17, 1, 0);   // ==> event log write
}
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Attacker invokes the public SPP RPC/COM method that lands in
   sub_140103484.
2. Function collects licence state bits and performs weak policy test
   (sub_14010EBD4).
3. sub_140102274 is optionally invoked to refresh the global status
   variable.
4. sub_1400A5B88 writes the computed licence information to the SPP
   event channel (Event ID 45036776).
5. Attacker reads the Windows event log to obtain the data.

Attack Vector
--------------------------------------------------------------------
Local, authenticated user.  Any account that can call the License
Manager RPC/COM interface (normally available to regular users) can
trigger the vulnerable code path without additional privileges.

Patch Description
--------------------------------------------------------------------
Both vulnerable routines were entirely replaced with thin wrappers that
delegate the request to virtual methods of an internal object:

    v2 = *(QWORD *)(a1 + 0x10);
    v4 = *(func **)(*v2 + 0x50);  // 0x50 / 0x20 depending on function
    _guard_check_icall_fptr(v4);
    return v4(v2, a2);

All previous logic – including bit manipulation, global variable access
and direct call to sub_1400A5B88 – has been removed.  The delegated
methods can apply proper filtering or decide not to log at all.

Security Impact
--------------------------------------------------------------------
Pre-patch, non-privileged users could disclose licence and activation
state information that Microsoft considers sensitive (e.g. tamper
flags, product key hash bits, activation counters).  This constitutes a
local information disclosure.

Fix Effectiveness
--------------------------------------------------------------------
The patch eliminates the entire code sequence responsible for emitting
log entries; therefore the direct path that leaked information is gone.
Without the vulnerable subroutine the event 45036776 can no longer be
forced by untrusted input.  Unless equivalent logging exists in the new
object method (not visible in the diff) the issue is fully mitigated.
