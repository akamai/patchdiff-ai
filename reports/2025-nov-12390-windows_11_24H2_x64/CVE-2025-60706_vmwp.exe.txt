{'kb': 'KB5068861', 'patch_store_uid': '75361f3a-f880-4fe3-9362-4c1d9f6cbe2c', 'confidence': 0.29, 'change_count': 5, 'cve': 'CVE-2025-60706', 'file': 'vmwp.exe', 'date': 1763409933.085624}
--------------------------------------------------------------------
CVE-2025-60706 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows Hyper-V (vmwp.exe) – WIL (Windows-in-line) feature-gating
telemetry helpers located in
wil::details::FeatureImpl::<T>::GetCurrentFeatureEnabledState() and
wil::details::FeatureImpl::<T>::ReportUsage().


Vulnerability Class
--------------------------------------------------------------------
Uninitialized register / parameter-mismatch that results in an out-of-
bounds read (CWE-125).


Detailed Root Cause Analysis
--------------------------------------------------------------------
On x64 Windows the first four function parameters are passed in the
registers RCX, RDX, R8 and R9.  Prior to the patch
wil::details::FeatureImpl<__WilFeatureTraits_Feature_TestGateImp>::
ReportUsage() was compiled with *two* formal parameters:
    RCX = pointer to feature implementation (unsigned int *)
    RDX = wil::ReportingKind  (unsigned __int8)

However every caller in vmwp.exe provided *only one* argument:

    wil::details::FeatureImpl<...>::ReportUsage(&impl);

Consequently RCX was valid but RDX retained whichever value happened to
be in the register.  Inside ReportUsage() the stale RDX value was copied
into a local variable (named v4 / a2) and forwarded to
wil::details::ReportUsageToService() as the ReportingKind argument.

    v2 = *a1;              // read feature flags
    v4 = a2;               // a2 is garbage from RDX
    ...
    return ReportUsageToService(..., v4, 0);

ReportUsageToService() indexes internal tables according to
ReportingKind.  With an out-of-range value it walks past the end of the
table and discloses adjacent kernel memory in the telemetry buffer that
is later returned to user mode, producing an information disclosure.

Several GetCurrentFeatureEnabledState() helpers rely on ReportUsage().
Because they never supplied the missing second parameter, every call
executed with an undefined ReportingKind, making the issue reliably
reachable by any operation that queries feature enablement in the
Hyper-V worker process.

Affected structures / fields:
  • wil::details::FeatureImpl::<T>::m_state (flag bits)
  • The stack frame used by ReportUsage() –   0x28-bytes structure
    containing uninitialised data propagated to ReportUsageToService.


Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// Before patch (vmwp.exe)
__int64 __fastcall ReportUsage(unsigned int *a1, unsigned __int8 a2)
{
   unsigned int v2 = *a1;
   int v4 = a2;             // RDX is UNINITIALISED!
   ...
   return ReportUsageToService(a1 + 2,
                               54237988i64,
                               (v2 >> 10) & 1,
                               (v2 >> 11) & 1,
                               &v7,
                               v4,        // garbage index
                               0);
}

// Call site
wil::details::FeatureImpl<...>::ReportUsage(&impl); // only 1 param
```


Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Guest / management code causes Hyper-V worker process to evaluate a
   WIL feature flag (e.g. TestGateImp).
2. GetCurrentFeatureEnabledState() decides to report usage and executes
   ReportUsage(&impl).  Only RCX is initialised.
3. ReportUsage() interprets the stale RDX value as ReportingKind and
   forwards it to ReportUsageToService().
4. ReportUsageToService() uses that value as an index, reading beyond
   the bounds of an internal array and copying memory into a telemetry
   buffer.
5. The buffer is ultimately returned to user mode, disclosing memory
   that lies after the legitimate array – an information disclosure.


Attack Vector
--------------------------------------------------------------------
Local, authorised attacker running code on the Hyper-V host (or inside a
privileged guest with VM-management privileges).  By repeatedly
triggering feature queries they obtain chunks of Hyper-V worker-process
memory that may contain sensitive data belonging to other VMs or the
host.


Patch Description
--------------------------------------------------------------------
1. ReportUsage() signature reduced to *one* parameter, matching all call
   sites.
2. The function now sets ReportingKind to a constant (1) internally and
   initialises the optional diagnostics structure:
      v6 = 3; v5 = 0;  ReportUsageToService(..., 1, 0);
3. GetCurrentFeatureEnabledState() helpers were refactored to remove any
   conditional logic that depended on the second parameter and now call
   the fixed ReportUsage() version.

These changes eliminate the use of an uninitialised register and ensure
that the index passed to ReportUsageToService() is always in range.


Security Impact
--------------------------------------------------------------------
Prior to the fix, arbitrary stack/register data were interpreted as an
array index inside ReportUsageToService(), producing an out-of-bounds
read.  The leaked data are included in Hyper-V telemetry and can be
retrieved by a local attacker, violating the confidentiality boundary of
both the VM and the host (Information Disclosure / CWE-125).


Fix Effectiveness
--------------------------------------------------------------------
The updated binary enforces a correct parameter count, fully
initialises the ReportingKind argument, and hard-codes it to a safe
value.  No remaining code path uses uninitialised data when calling
ReportUsageToService(), so the specific OOB read is no longer possible.
A brief audit of all remaining ReportUsage() invocations confirms that
callers and callee signatures now match.  The patch is therefore
considered effective.
