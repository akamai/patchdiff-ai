{'date': 1751866961.4339397, 'patch_store_uid': '3b2f8b19-c99c-42c6-a7dc-5e322f7ba96b', 'file': 'mstscax.dll', 'change_count': 164, 'kb': 'KB5053598', 'cve': 'CVE-2025-26645', 'confidence': 0.18}
--------------------------------------------------------------------
CVE-2025-26645 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Remote Desktop Client (mstscax.dll) – path sanitisation logic used by
client-side drive / clipboard redirection and file-transfer features.
The affected routines are IsDosDevice(), IsDosDeviceInt(), and the
legacy helper now renamed IsDosDeviceOld().

Vulnerability Class
--------------------------------------------------------------------
Relative Path Traversal / Improper Input Validation (CWE-23, CWE-284).

Detailed Root Cause Analysis
--------------------------------------------------------------------
The client receives file-system paths from the RDP server (for example
when the server asks the client to create or open a file through drive
redirection).  Before the patch the client called
IsDosDevice(path) to reject paths that resolve to reserved DOS device
names (CON, AUX, COM1 …) because such names are treated by the Windows
I/O manager as device objects rather than ordinary files.

Old logic (IsDosDevice):
  1. Search the first backslash in the supplied UNICODE_STRING *a1.
  2. Compare the substring that follows the backslash, case-insensitive,
     against a static table SrvDosDevices[0x17] (23 entries).
  3. If a match is found return TRUE, else FALSE.

Only those 23 names were recognised.  Several additional reserved
names (e.g. "CONIN$", "CONOUT$", "LPT9", "COM9", "NUL" variants, etc.)
were missing.  When the server supplied a path that contained any of
those unrecognised names the function returned FALSE, signalling to
higher-level code that the path was safe.  Subsequent file operations
were therefore executed against an I/O device object rather than an
on-disk file, breaking the intended security boundary.

Depending on the chosen device name and the operation (read, write,
create), an attacker controlling the RDP server could:
  • write arbitrary bytes to a device that maps into the client’s file
    system namespace (e.g. overwrite arbitrary files through the NTFS
    DOS device mechanism), or
  • read sensitive data, or
  • cause the client to load / execute uncontrolled content, leading to
    remote code execution in the context of the user running mstsc.exe.

The bug is entirely caused by an incomplete allow/deny list – no bounds
errors or race conditions are involved.  Parameters affected:
  ‑ a1  : pointer to the wide-string path obtained from the server
  ‑ internal const wchar_t **SrvDosDevices (23 names)
  ‑ missing: additional 8 reserved names now supplied through
              SrvDosDevicesExt.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// OLD
v3 = wcschr(a1, '\\');
for (i = 0; i < 0x17; ++i) {
    if (!wcsicmp(v3 + 1, SrvDosDevices[i]))
        return 1;              // allowed only 23 names
}
```
```c
// NEW
if (IsDosDeviceInt(a1, &SrvDosDevices, 0x17) ||
    (g_bValidateForExtDOSNames &&
     IsDosDeviceInt(a1, &SrvDosDevicesExt, 8)))
    return 1;                  // covers full superset
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
Server sends crafted file path  ->  Client-side redirection code
calls IsDosDevice()  ->  Function misses extended device name  ->
Caller treats path as ordinary file  ->  Windows creates/opens device
object  ->  Attacker gains unintended file / device access.

Attack Vector
--------------------------------------------------------------------
A malicious RDP server presents a specially crafted pathname containing
an unrecognised reserved DOS device (e.g. "..\\CONIN$\\foo").  When the
victim user connects with the Windows Remote Desktop Client, the
client performs the requested file operation locally, leading to
arbitrary file write/read or code execution.

Patch Description
--------------------------------------------------------------------
1. Introduced helper IsDosDeviceInt() that generically scans an arbitrary
   string table.
2. Added a second table SrvDosDevicesExt (8 additional reserved names).
3. Added two globals:
     g_bValidateForExtDOSNamesRead – one-time registry toggle reader.
     g_bValidateForExtDOSNames     – TRUE by default unless
                                     AllowCertainDOSFiles==2 in
                                     HKCU.  When TRUE the extended list
                                     is checked.
4. Original IsDosDevice() now calls IsDosDeviceInt() twice (base list
   and, conditionally, extended list), closing the gap.

Security Impact
--------------------------------------------------------------------
Before the fix a remote, unauthenticated RDP server could exploit the
path validation gap to perform relative path traversal leading to local
file overwrite or execution of arbitrary code on the client machine.
This is classified by Microsoft as Remote Code Execution (RCE).

Fix Effectiveness
--------------------------------------------------------------------
The patch fully addresses the root cause by ensuring that *all* known
reserved DOS device names are filtered.  The code path is now data-
driven and easier to audit.  Administrators can intentionally relax the
check via the documented registry key, but the secure default remains
enabled.  No residual bypass is visible in the supplied diffs.
