{'kb': 'KB5053598', 'confidence': 0.36, 'patch_store_uid': '14604a4c-0db0-47c1-b611-b2fcc654f933', 'cve': 'CVE-2025-24071', 'change_count': 189, 'date': 1751831488.5761058, 'file': 'windows.ui.fileexplorer.dll'}
--------------------------------------------------------------------
CVE-2025-24071 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
windows.ui.fileexplorer.dll  (File Explorer / Windows.UI.FileExplorer
utility helpers)

Vulnerability Class
--------------------------------------------------------------------
Information Disclosure / Spoofing caused by improper object type
validation (CWE-200)

Detailed Root Cause Analysis
--------------------------------------------------------------------
The DLL exports a helper called
GetShellItemFromNavigationTarget(IUnknown *,IShellItem **).  In the
vulnerable build the export was incorrectly resolved to the destructor
of an unrelated template class
  ~FileExplorerFolderViewController(...)
which merely executed
  return BaseClassDtor(a1 + 0x50);
This surrogate implementation blindly treats the first parameter as a
valid FileExplorerFolderViewController object and dereferences it with
an 0x50-byte positive offset before invoking a virtual destructor.
No interface check, no reference counting, and no HRESULT are
returned.  Supplying any other IUnknown pointer therefore results in an
out-of-bounds object access inside Explorer’s process.  Information
contained in the adjacent memory (including path strings and other UI
state) can be read back or mis-interpreted, enabling spoofing of the
address-bar or detail panes.

The patched build restores a correct implementation.  The routine now

1. Calls IUnknown_QueryService to translate the inbound IUnknown into
   a folder navigation service (GUID
   2ce15729-376f-4372-ad30-4148a6326ee8).
2. Uses that service’s virtual GetObject call (vtable +0x58) to obtain
   an IUnknown representing the navigation target.
3. Invokes SHGetItemFromObject to securely retrieve the corresponding
   IShellItem pointer for the caller.
4. Propagates any failure as a proper HRESULT and releases every COM
   reference acquired.

All pointer use is now guarded by COM-style interface discovery and the
function never dereferences attacker-controlled memory directly.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
/* vulnerable build */
__int64 __fastcall ExportedSymbol(__int64 a1)
{
    return BaseClassDtor(a1 + 0x50); // unchecked offset into caller
}

/* fixed build */
HRESULT __fastcall GetShellItemFromNavigationTarget(IUnknown *unk,
                                                   IShellItem **ppsi)
{
    void  *srv = NULL;
    IUnknown *punk = NULL;
    HRESULT hr = IUnknown_QueryService(unk,&IID_SomeSvc,&IID_SomeSvc,&srv);
    if (FAILED(hr)) goto Exit;
    hr = ((PFN)(*(PVOID *)srv)[11])(srv,&IID_IShellFolder,&punk);
    if (FAILED(hr)) goto Exit;
    hr = SHGetItemFromObject(punk,&IID_IShellItem,(void**)ppsi);
Exit:
    if (punk) punk->Release();
    if (srv)  ((IUnknown*)srv)->Release();
    return hr;
}
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Explorer processes a navigation request and passes an IUnknown that
   may originate from a network-delivered COM proxy.
2. Explorer calls exported GetShellItemFromNavigationTarget.
3. Vulnerable build immediately executes a destructor on (a1+0x50),
   touching arbitrary memory.
4. Memory adjacent to the attacker-controlled buffer is interpreted as
   internal data and can be surfaced in UI elements.

Attack Vector
--------------------------------------------------------------------
An attacker supplies a malicious navigation target (eg. crafted
shortcut, library, or remote COM object) over the network.  When
Explorer invokes the helper export, the wrong implementation operates
on attacker-controlled memory, allowing spoofing of folder paths or
exposure of memory belonging to the Explorer process.

Patch Description
--------------------------------------------------------------------
The export was re-implemented.  The new code:
* Performs proper service discovery with IUnknown_QueryService
* Obtains the target IShellItem through SHGetItemFromObject
* Returns HRESULTs and records diagnostics with wil::Return_Hr
* Releases all intermediate COM interfaces unconditionally
No unsafe pointer arithmetic remains.

Security Impact
--------------------------------------------------------------------
Prior to the patch, arbitrary memory could be read or interpreted as
shell data, letting a network attacker spoof File Explorer UI
indicators or leak private information from the process heap.  While
no direct code execution is shown, the issue violates process memory
isolation and user trust in displayed paths.

Fix Effectiveness
--------------------------------------------------------------------
The vulnerable offset dereference path has been completely removed.
Interface validation, explicit error handling, and reference tracking
eliminate the previously unsafe memory access, fully neutralising the
spoofing / disclosure primitive.
