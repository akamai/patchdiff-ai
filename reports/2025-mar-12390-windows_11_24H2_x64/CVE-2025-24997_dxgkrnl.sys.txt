{'date': 1751831496.5763185, 'patch_store_uid': 'a609137f-6c45-481b-84ad-293a321dd24d', 'change_count': 39, 'kb': 'KB5053598', 'file': 'dxgkrnl.sys', 'confidence': 0.29, 'cve': 'CVE-2025-24997'}
--------------------------------------------------------------------
CVE-2025-24997 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Microsoft Windows – dxgkrnl.sys (DirectX Graphics Kernel)
Sub-component: object/property handling (CProperty)

Vulnerability Class
--------------------------------------------------------------------
NULL-pointer dereference (CWE-476)

Detailed Root Cause Analysis
--------------------------------------------------------------------
Each logical property in the graphics kernel is represented by a
CProperty object whose second pointer-sized field (+0x08) holds the
address of a ReferenceCounted value.  When the property is deleted or
re-initialised the value must be released and the field cleared.

Before the patch the clean-up routine was implemented in
CJScript9Holder::ReinitializeOrClearObject(), which executed only when
Feature_H2E_WPA3SAE__private_IsEnabledDeviceUsage_23() returned true.
Instead of loading the stored value pointer, the routine blindly
passed the CProperty ("this") pointer to
DxgMonitor::USB4POFXREF_REF_ACCESSOR::Release:

    DxgMonitor::USB4POFXREF_REF_ACCESSOR::Release(a1);

Because a1 is **not** a valid USB4POFXREF_REF_ACCESSOR object, the
callee immediately dereferenced random/NULL memory.  If the stored
value pointer was NULL – the most common state when a property was
never initialised – the access happened at address 0x0, raising bug
check 0x50 (PAGE_FAULT_IN_NONPAGED_AREA) and crashing the system.

Thus any execution path that destroyed a CProperty while the feature
flag was enabled could instantly trigger a kernel-mode NULL pointer
read, resulting in a system-wide denial of service.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// before
void CJScript9Holder::ReinitializeOrClearObject(CBase *a1, CMarkup *a2)
{
    if (Feature_H2E_WPA3SAE__private_IsEnabledDeviceUsage_23())
        DxgMonitor::USB4POFXREF_REF_ACCESSOR::Release(a1); // wrong ptr
}

// after
void CProperty::FreeValue(CProperty *this)
{
    ReferenceCounted *val = *((ReferenceCounted **)this + 1); // +0x08
    if (val)
    {
        ReferenceCounted::Release(val);
        *((ReferenceCounted **)this + 1) = nullptr; // clear field
    }
}
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. User-mode application issues a D3DKMT/IOCTL or API that removes a
   device property.
2. Kernel enters dxgkrnl!CProperty::FreeValue (old name
   CJScript9Holder::ReinitializeOrClearObject).
3. Feature flag is enabled ➔ function calls Release() with the **this**
   pointer instead of the property value pointer.
4. Release() dereferences the invalid/NULL pointer ➔ bug-check ➔ system
   crash.

Attack Vector
--------------------------------------------------------------------
Local, authenticated attacker running graphics APIs.  No additional
privileges are required; the bug can be triggered from any session
that is able to create and delete DirectX properties (e.g. via
D3DKMTCreateAllocation + D3DKMTDestroyAllocation sequences).

Patch Description
--------------------------------------------------------------------
The vulnerable routine has been replaced by a correctly named
CProperty::FreeValue() implementation that:
1. Loads the stored value pointer from offset +0x08.
2. Checks the pointer for NULL before use.
3. Calls ReferenceCounted::Release() with the correct argument.
4. Clears the member to prevent stale references.

The erroneous call to DxgMonitor::USB4POFXREF_REF_ACCESSOR::Release()
was completely removed.

Security Impact
--------------------------------------------------------------------
Before the patch any attempt to free an uninitialised or already
cleared property caused an immediate kernel crash, leading to a local
denial of service (system reboot) but no privilege escalation or
information disclosure.

Fix Effectiveness
--------------------------------------------------------------------
The new code path validates the pointer and uses the appropriate
release helper, eliminating the NULL dereference.  No remaining code
paths in CProperty::FreeValue dereference unchecked pointers, so the
patch fully mitigates CVE-2025-24997.
