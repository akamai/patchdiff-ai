{'date': 1751781049.6856084, 'file': 'vmwp.exe', 'change_count': 12, 'patch_store_uid': '6f33e6a9-2b4a-4b56-bc30-175ecfc2250c', 'confidence': 0.17, 'cve': 'CVE-2025-29955', 'kb': 'KB5058411'}
--------------------------------------------------------------------
CVE-2025-29955 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows Hyper-V Worker Process (vmwp.exe) – statistics and metrics
sub-system (classes WorkerStatsPanel / WorkerHvStatsPanel and their
callers ProcessorMetricDevice, VidPartitionManager).

Vulnerability Class
--------------------------------------------------------------------
Null-pointer dereference / improper input validation (CWE-20).

Detailed Root Cause Analysis
--------------------------------------------------------------------
Each WorkerStatsPanel instance contains an embedded
WorkerHvStatsPanel object that is only present after the hypervisor
stats page has been successfully mapped.  The availability of that
sub-object is indicated by internal state queried through the helper
method WorkerStatsPanel::IsAvailable().

Prior to the patch several public helper routines assumed the stats
page was always present:
  • WorkerStatsPanel::GetRuntimeForAllProcessors()
  • VidPartitionManager::GetHvPartitionRetailStats_L1VH_2409()
  • ProcessorMetricDevice::CreateProcessorMetric()

All three functions blindly dereferenced fields that are only valid
when IsAvailable()==true.

Example – GetRuntimeForAllProcessors(before):
  v3 = *((_QWORD*)this + 6);          // pointer to WorkerHvStatsPanel
  AcquireSRWLockShared( (PSRWLOCK)(v3+80) );   <-- NULL possible

If the VM is queried very early in its lifetime, or after stats were
unmapped, the ‘v3’ pointer is NULL.  The subsequent lock acquisition
or list walk touches address 0x80, raising an access-violation in
vmwp.exe and terminating the worker process hosting the guest VM.

A malicious local user can reliably reach this state by repeatedly
querying performance/metrics interfaces (WMI, ETW, Hyper-V counters)
while the target VM is starting, resetting, or shutting down, forcing
vmwp.exe to call the vulnerable helpers before the stats page becomes
available.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// before
v3 = *((_QWORD*)this + 6);
AcquireSRWLockShared((PSRWLOCK)(v3 + 80));   // CRASH if v3==0
...                                          // walks internal lists
```

```c
// after
if (WorkerStatsPanel::IsAvailable((WorkerStatsPanel*)this))
{
    ... // safe use
}
else
{
    *a3 = 0;      // or *a2 = {0}
}
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
Client API / WMI request
 → ProcessorMetricDevice::CreateProcessorMetric()
   → WorkerStatsPanel::GetAllVpTotalRunTime()
     → WorkerStatsPanel::GetRuntimeForAllProcessors()  [vulnerable]
       – NULL dereference → unhandled AV → vmwp.exe crash.

(or)
Client API → VidPartitionManager::GetHvPartitionRetailStats_L1VH_2409()
   → direct access to stats page pointer without validation.

Attack Vector
--------------------------------------------------------------------
Local attacker on the host (or inside a management VM with Hyper-V
privileges) issues repeated performance/metric queries against a VM
while that VM is in a state where its WorkerStatsPanel is not yet
available.  No special privileges beyond the ability to query metrics
are required.  Result: vmwp.exe for the target VM crashes, stopping
and resetting the guest – a denial of service.

Patch Description
--------------------------------------------------------------------
The fix introduces explicit availability checks:
  • New helper WorkerStatsPanel::IsAvailable() is called at the top of
each affected routine.
  • When unavailable the functions return zeros and skip all internal
dereferences.
  • Where the stats page is available the code now chooses the correct
HvStatsPanel instance through a feature flag and passes the pointer
safely.
  • Similar guards were added to ProcessorMetricDevice and
VidPartitionManager.

Security Impact
--------------------------------------------------------------------
Before the patch a non-privileged local actor could crash vmwp.exe,
immediately powering off the associated guest VM(s).  Repetition could
lead to sustained denial of service of Hyper-V workloads on the host.
No privilege escalation or data corruption was observed.

Fix Effectiveness
--------------------------------------------------------------------
The added IsAvailable() gate removes all paths that could dereference a
NULL WorkerHvStatsPanel pointer.  Returned default values ensure the
public APIs remain functional even when stats are not yet ready.  The
patch fully mitigates the observed crash condition; no remaining
unchecked dereferences were found in the modified code sections.
