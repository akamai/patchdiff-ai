{'kb': 'KB5055523', 'date': 1751820796.2732675, 'confidence': 0.17, 'change_count': 9, 'cve': 'CVE-2025-27736', 'file': 'pdc.sys', 'patch_store_uid': 'ba473335-b94f-482a-a28e-7827b7da930b'}
--------------------------------------------------------------------
CVE-2025-27736 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows Power Dependency Coordinator driver (pdc.sys) – code paths that
construct and deliver V2 activation-related messages between the kernel
and a user-mode “Activator” client (PdcpV2* family, resiliency helper
routines, activator initialisation).

Vulnerability Class
--------------------------------------------------------------------
Information disclosure / kernel pointer leak (CWE-200: Exposure of
Sensitive Information to an Unauthorized Actor).

Detailed Root Cause Analysis
--------------------------------------------------------------------
Each activation instance is represented in kernel by an
ACTIVATION_INSTANCE structure returned by ExAllocatePool2.  Prior to the
patch this structure’s **kernel virtual address** was copied verbatim
into outbound messages that are ultimately delivered to a user-mode
client:
  • PdcpV2SendCallbackMessage :   v6[7] = a1;
  • PdcpV2Activation          :   message field 0x400 = v6 (ptr);
  • PdcpV2Deactivation/Renew  :   same pattern
  • PdcpCompleteResiliencyOperation :   *(v1+400) = a1;

The buffer is sent to user land through PdcpSendMessageToActivatorClient
or PdcpReplyActivatorClient, giving an unprivileged local process a raw
kernel pointer.  Disclosure of kernel addresses breaks KASLR and can be
combined with other bugs to achieve elevation of privilege.

Patch analysis shows a new 8-byte field added at offset +0x348 (848-byte
allocation vs 840 before).  At creation time
(PdcpCreateActivationInstance) this field is initialised with a per
activator monotonically increasing **InstanceId** held at +0x488 in the
activator object:
    *((QWORD*)Instance+105) = (*((QWORD*)Activator+145))++;

All message construction sites now perform:
    if (Feature_IsEnabled())
        send_value = Instance->InstanceId;   // 64-bit opaque handle
    else
        send_value = Instance;              // legacy path

A symmetric helper PdcpDecodeActivationInstanceHandle converts the
opaque id back to a pointer when a reply reaches the kernel.  The net
effect is that user mode receives an activator-local numeric token
instead of a direct VA, sealing the information leak.

Secondary changes (size-adjusted memset, ExUnregisterCallback ->
ObfDereferenceObject etc.) are hardening only.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// before
memset(v6, 0, 0x320);
LODWORD(v6[5]) = 12;
v6[7] = a1;                 // kernel pointer leaked
...
PdcpSendMessageToActivatorClient(v4, v6);

// after
memset(v6, 0, sizeof(v6));
LODWORD(v6[5]) = 12;
if (Feature_IsEnabled())
    v6[7] = *(QWORD*)(a1 + 0x348); // opaque id
else
    v6[7] = a1;                    // fallback legacy
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. User-mode process registers as an Activator.
2. It issues an activation/renew/deactivation request.
3. Kernel creates or manipulates an ACTIVATION_INSTANCE.
4. Pdcp* routine packages a reply or callback.
5. Raw structure pointer copied into message buffer.
6. Message delivered to user process -> kernel VA disclosed.

Attack Vector
--------------------------------------------------------------------
Any local, authenticated process capable of calling the public PDC
activation interface (e.g. via power management APIs or the
ActivatorService) can trigger a V2 activation sequence and read the
resulting reply or callback to obtain kernel addresses without needing
additional privileges.

Patch Description
--------------------------------------------------------------------
• Enlarges ACTIVATION_INSTANCE by 8 bytes and adds a per-instance opaque
  identifier.
• Maintains a per-activator counter to guarantee uniqueness.
• Introduces PdcpDecodeActivationInstanceHandle helper.
• Replaces all user-visible pointer assignments with the opaque id when
the new feature flag is enabled (default in supported builds).
• Adjusts memset size arguments and converts a callback clean-up path to
  ObfDereferenceObject for correctness.

Security Impact
--------------------------------------------------------------------
Leaked kernel virtual addresses defeat KASLR and make further kernel
memory corruption exploits significantly easier, enabling privilege
escalation.  No direct elevation is provided, but the weakness reduces
system security guarantees.

Fix Effectiveness
--------------------------------------------------------------------
The patch removes direct pointer exposure and confines user-mode clients
to opaque, activator-local identifiers.  Provided the feature flag
remains enabled on production builds, the information disclosure avenue
is closed.  No residual pointer copies were observed in the patched
paths, so the fix is considered effective.
