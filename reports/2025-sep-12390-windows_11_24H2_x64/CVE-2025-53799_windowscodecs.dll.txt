{'confidence': 0.29, 'patch_store_uid': '8a014453-9805-479e-8b6a-7f5f1c3c9151', 'change_count': 357, 'kb': 'KB5065426', 'cve': 'CVE-2025-53799', 'date': 1757843629.7153378, 'file': 'windowscodecs.dll'}
--------------------------------------------------------------------
CVE-2025-53799 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows Imaging Component (WIC), old JPEG decoder (WICOldJPEGLib) in
windowscodecs.dll. Vulnerable logic lives in the input-controller
initialisation and reset routines.

Vulnerability Class
--------------------------------------------------------------------
CWE-908: Use of Uninitialized Resource (wrong function pointer leads to
invocation of routine with wrong prototype, resulting in use of
uninitialized arguments and memory reads).

Detailed Root Cause Analysis
--------------------------------------------------------------------
The JPEG input controller is allocated at offset 0x544 inside the main
codec object. The structure layout is:
  +0x00  consume_markers              (func ptr)
  +0x08  reset_input_controller       (func ptr)
  +0x10  start_input_pass             (func ptr)
  +0x18  finish_input_pass            (func ptr)
  +0x20  state fields (word, byte, …)

During initialisation (jinit_input_controller) the code allocates 48
bytes for the controller and fills the dispatch table. In the buggy
version it assigns the reset_input_controller pointer to
sub_1467A91A0, which is actually
WICOldJPEGLib::h2v1_fancy_upsample_intellib – a helper that expects the
prototype
    void **func(__int64 a1, __int64 a2, __int64 a3, __int64 *a4)

At run-time, WIC later calls
    controller->reset_input_controller(codec_object);
passing *only* RCX (a1).  The callee therefore executes with RDX, R8
and R9 still holding the transient values left by the call-site.  The
function immediately dereferences these registers:
  *(unsigned int *)(a2 + 40);        // a2 is uninitialised
  *(_QWORD *)(a3 + 8 * i);           // a3 is uninitialised
  *a4;                               // a4 is uninitialised pointer

The out-of-contract access leaks process memory through the
ippiSampleUpRowH2V1_Triangle_JPEG call chain, creating an information
exposure primitive.  On some builds it can also crash the process when
invalid pages are touched.

The patched build replaces the wrong pointer with a new function that
matches the single-argument contract and explicitly re-initialises the
controller state:
  *v1        = consume_markers;
  *(WORD)    = 0;
  *(BYTE)    = 1;
  call consume_markers();
  call next_state();
  codec->some_field = 0;

No uninitialised arguments are used.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// vulnerable assignment (before)
*(_QWORD *)(result + 8) = sub_1467A91A0; // wrong prototype

// buggy function that will be called with 1 arg instead of 4
void **h2v1_fancy_upsample_intellib(__int64 a1, __int64 a2,
                                    __int64 a3, __int64 *a4)
{
    for (i = 0; i < *(DWORD *)(a1 + 468); ++i)
        g_pfnIppiSampleUpRowH2V1_Triangle_JPEG_8u_C1(
              *(QWORD *)(a3 + 8*i),      // uses uninitialised a3
              *(DWORD *)(a2 + 40),       // uses uninitialised a2
              *(QWORD *)(*a4 + 8*i));    // uses uninitialised a4
}

// fixed assignment (after)
*(_QWORD *)(result + 8) = reset_input_controller; // correct function

// safe reset function (after)
__int64 reset_input_controller(__int64 a1)
{
    v1 = *(QWORD *)(a1 + 544);
    *(QWORD *)v1     = consume_markers;
    *(WORD *)(v1+32) = 0;
    *(BYTE *)(v1+40) = 1;
    (*(func*)(*(QWORD*)a1 + 32))(a1);
    result = ((func*)(a1+552))[0](a1);
    *(QWORD *)(a1 + 176) = 0;
    return result;
}
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Application decodes a JPEG via WIC.
2. jinit_input_controller() runs and stores wrong function pointer at
   controller+0x08.
3. Decoder later calls controller->reset_input_controller(codec).
4. h2v1_fancy_upsample_intellib executes with only RCX initialised.
5. The function reads from uninitialised RDX/R8/R9, disclosing memory
   contents to the output buffer or causing a crash.

Attack Vector
--------------------------------------------------------------------
A local attacker provides a crafted JPEG that is decoded by any
application relying on WIC (e.g., Windows Photos, Explorer thumbnails).
No special privileges are required; code execution is not needed.

Patch Description
--------------------------------------------------------------------
1. Added new routine reset_input_controller that adheres to the single
   parameter calling convention and safely re-initialises internal
   state.
2. jinit_input_controller now assigns the reset_input_controller
   pointer to this new function instead of the unrelated up-sampling
   helper.
3. The obsolete h2v1_fancy_upsample_intellib implementation is no
   longer reachable through the input controller dispatch table.

Security Impact
--------------------------------------------------------------------
Before the patch, arbitrary stack/register residue could be used as
pointers, allowing information disclosure and potential denial of
service in any process that decodes untrusted JPEGs with WIC.  The
issue is classified as an information disclosure vulnerability
(CVE-2025-53799).

Fix Effectiveness
--------------------------------------------------------------------
The dispatch table now points to a correctly prototyped function that
uses only the provided parameter and explicitly zeros state fields,
eliminating the uninitialised memory access. No remaining code paths
appear to reference the old helper, so the fix is believed to be
complete, although full binary-wide auditing was not performed (state
coverage outside the diff is unknown).
