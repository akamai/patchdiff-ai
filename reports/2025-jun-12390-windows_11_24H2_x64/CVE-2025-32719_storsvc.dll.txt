{'file': 'storsvc.dll', 'change_count': 17, 'cve': 'CVE-2025-32719', 'kb': 'KB5060842', 'patch_store_uid': 'e357b706-c599-45dd-b928-3b319eb9aed7', 'date': 1763416876.7097025, 'confidence': 0.24}
--------------------------------------------------------------------
CVE-2025-32719 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows Storage Service (storsvc.dll), routine
ScValidateProvisioning()


Vulnerability Class
--------------------------------------------------------------------
Out-of-bounds Read / Missing bounds validation (CWE-125)


Detailed Root Cause Analysis
--------------------------------------------------------------------
ScValidateProvisioning() verifies the caller-supplied
_SP_PROVISIONING_INFO structure before the data is used by other
storage-management code.  The structure contains several 32-bit
fields describing provisioning ranges.  Relevant fields are shown
below (index in dword units):
  5 – Minimum supported provisioning type
  6 – Recommended provisioning type  (optional)
  7 – Maximum supported provisioning type

Prior to the patch the routine only checked that field 5 and field 6
were within [1,5] and that 5 <= 6.  Field 7 was *never* validated.
If the caller supplied an out-of-range value (0 or >5) or a value
smaller than field 5, the function still returned STATUS_SUCCESS.

Later code (outside the diff) treats the triplet {Min,Max,Current}
as array indices and iterates from Min to Max, blindly trusting the
values.  Because Max could now be zero or any large uint32, the loop
could read past the end of the internal table, disclosing memory that
belongs to the storsvc process running as SYSTEM.

On devices where the H2E_WPA3SAE feature flag is enabled, a second
path uses field 6 the same way, so an out-of-range value in field 6
could also drive an over-read as long as field 7 was larger.

Thus the root cause is an incomplete parameter validation that failed
to constrain the upper boundary of a caller-controlled range.


Vulnerability Code Snippets
--------------------------------------------------------------------
```c
/* before patch */
if (v7 - 1 > 4)                       // check field 5 (Min)
    return STATUS_INVALID_PARAMETER;
if (v8 - 1 > 4 || v7 > v8)           // check field 6 (Current)
    return STATUS_INVALID_PARAMETER;
/* field 7 (Max) NOT CHECKED */
```
```c
/* after patch */
if ((DWORD)(*(DWORD*)a1 + 5) - 1 > 4)
    return STATUS_INVALID_PARAMETER;  // field 5 (Min)
...
if (Feature_H2E_WPA3SAE_IsEnabled()) {
    v8 = *(DWORD*)a1 + 6;             // field 6 (Current)
    if (v8 && (v8 - 1 > 4 || Min > v8 || v8 >= *(DWORD*)a1 + 7))
        return STATUS_INVALID_PARAMETER;
}
v9 = *(DWORD*)a1 + 7;                 // field 7 (Max)
if (v9 - 1 > 4 || Min > v9)           // NEW validation
    return STATUS_INVALID_PARAMETER;
```


Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Attacker calls a user-mode storage API (e.g.
   IVdsAdmin::CreateLun or an IOCTL) that ends up constructing an
   _SP_PROVISIONING_INFO buffer.
2. Buffer is passed to ScValidateProvisioning() inside the privileged
   storsvc service.
3. Because field 7 is not validated, ScValidateProvisioning() returns
   success even though Max is out of range.
4. Subsequent logic uses Max as an iterator bound, reading beyond the
   end of an internal table and copying the data back to the attacker
   (information disclosure).


Attack Vector
--------------------------------------------------------------------
Local, authenticated.  The attacker must be able to invoke storage
provisioning operations (available to standard users through several
Windows APIs and IOCTLs).


Patch Description
--------------------------------------------------------------------
1. Added explicit validation of field 7 (Max): value must be in
   [1,5] and must not be smaller than field 5.
2. When the WPA3SAE feature flag is enabled, tightened validation of
   field 6 so that it is also within range and strictly less than
   field 7.
3. No functional changes other than extra checks; return codes remain
   unchanged.


Security Impact
--------------------------------------------------------------------
Without the checks, an attacker can cause storsvc to read memory
beyond a fixed array and return those bytes, potentially disclosing
sensitive SYSTEM-level information.  Code execution is not achieved;
impact is limited to information disclosure.


Fix Effectiveness
--------------------------------------------------------------------
The added comparisons fully constrain all three provisioning fields
(Min, Current, Max) to the accepted 1..5 range and enforce the proper
ordering relationships.  Consequently the later loops cannot step
outside the array bounds, preventing further out-of-bounds reads.
No bypass is known from the provided diff.
