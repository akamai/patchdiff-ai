{'confidence': 0.35, 'patch_store_uid': 'e357b706-c599-45dd-b928-3b319eb9aed7', 'change_count': 17, 'cve': 'CVE-2025-33062', 'kb': 'KB5060842', 'date': 1763415532.5497787, 'file': 'storsvc.dll'}
--------------------------------------------------------------------
CVE-2025-33062 Report
--------------------------------------------------------------------

Component
--------------------------------------------------------------------
Windows Storage Service (storsvc.dll) – specifically the provisioning
validation helper ScValidateProvisioning() that is used by the Storage
Management Provider when processing user-supplied provisioning
requests.

Vulnerability Class
--------------------------------------------------------------------
Out-of-bounds Read / Improper Input Validation (CWE-125)

Detailed Root Cause Analysis
--------------------------------------------------------------------
_SP_PROVISIONING_INFO is an opaque structure received from user mode
code that describes the way a physical space is partitioned.  Relevant
fields (DWORD-array indices shown):
  +4  CountOfTierEntries (must be <=5)
  +5  FirstTierIndex      (1-4)
  +6  SecondTierIndex     (1-4 or 0)
  +7  HighestTierIndex    (1-4)

Prior to the patch ScValidateProvisioning() only verified indices 5 and
6:
  if (idx5-1 > 4)             → error
  if (idx6-1 > 4 || idx5>idx6)→ error

There was *no* validation for the value stored at offset +7.  A caller
could therefore supply an arbitrary number in HighestTierIndex while
still passing the above tests.  Subsequent code (e.g. in
SiCreateReadCache and other tier-handling routines) trusts this field
and uses it as an index into fixed-size tables (size 4 or 5).  If
HighestTierIndex ≥5 the code reads outside the bounds of those tables,
leaking adjacent kernel memory back to the caller and creating an
information-disclosure primitive.

Patch 10.0.\* adds the missing checks and enforces logical ordering
between the three indices:
  • range check of +7 (1-4)
  • idx5 ≤ idx7
  • when a feature flag is set it also validates idx6 against idx7 and
    rejects the case idx6 ≥ idx7

If any of the new predicates fail the function now returns
STATUS_INVALID_PARAMETER_MIX (-1058603007), preventing the later out-
of-bounds table access.

Vulnerability Code Snippets
--------------------------------------------------------------------
```c
// before
v7 = *((_DWORD *)a1 + 5);           // idx5
if (v7 - 1 > 4) return ERR;
v8 = *((_DWORD *)a1 + 6);           // idx6
if (v8 - 1 > 4 || v7 > v8) return ERR;
// <no checks for *((_DWORD*)a1+7)>  // idx7
```
```c
// after
if (Feature_H2E_WPA3SAE__private_IsEnabledDeviceUsage()) {
    v8 = *((_DWORD *)a1 + 6);       // idx6
    if (v8 && (v8 - 1 > 4 || v5 > v8 || v8 >= *((_DWORD *)a1 + 7)))
        return ERR;
}
v9 = *((_DWORD *)a1 + 7);           // idx7
if (v9 - 1 > 4 || v5 > v9)          // range & order check
    return ERR;
```

Trigger Flow (Top-Down)
--------------------------------------------------------------------
1. Attacker supplies crafted _SP_PROVISIONING_INFO via Storage
   Management interfaces (e.g. VDS, WMI, or proprietary IOCTL).
2. Storage service invokes ScValidateProvisioning().
3. Pre-patch: malformed HighestTierIndex passes validation.
4. Later code treats idx7 as table offset and performs
   TierTable[idx7] → OOB read.
5. Memory past the array boundary is returned to user space (log,
   WMI, or completion buffer), disclosing kernel data.

Attack Vector
--------------------------------------------------------------------
Local, authenticated attacker that can issue provisioning operations to
the Storage Management Provider (e.g. PowerShell Storage cmdlets or
VDS APIs) crafts a provisioning structure with HighestTierIndex >=5 to
cause an out-of-bounds read.

Patch Description
--------------------------------------------------------------------
The update augments ScValidateProvisioning() with:
  • explicit range/ordering checks on DWORDs at offsets +6 and +7.
  • conditional validation when feature flag
    Feature_H2E_WPA3SAE__private_IsEnabledDeviceUsage() is enabled.
  • early bailout with STATUS_INVALID_PARAMETER_MIX when the new
    predicates fail.
No other functional changes are required; the added checks fully block
invalid indices before they are ever dereferenced.

Security Impact
--------------------------------------------------------------------
Before the fix a crafted provisioning request could force the service
to read outside the bounds of an internal 4-element tier table,
returning uninitialized kernel memory to user mode.  This constitutes
an information disclosure that could aid local privilege-escalation or
security-feature bypass attacks.

Fix Effectiveness
--------------------------------------------------------------------
The added boundary and relationship checks cover every path where the
previously unvalidated index is consumed.  All out-of-range values now
lead to a deterministic error return, so the known OOB read condition
is no longer reachable.  No residual variant is visible in the patched
code.
